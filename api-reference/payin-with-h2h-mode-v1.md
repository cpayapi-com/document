# Payin with H2H Mode(v1)

[Home](https://github.com/cpayapi-com/document/blob/main/README.md) /
[API Reference Overview](https://github.com/cpayapi-com/document/blob/main/api-reference/overview.md) / 
_Payin with H2H Mode(v1)_

## Description
This endpoint will help merchants to complete a pay-in transaction with `Host to Host` mode, without `Payment Page`.

> Note: The difference between `v1` and `v2`:
> - v1: `Content-Type: application/x-www-form-urlencoded`
> - v2: `Content-Type: application/json`

## Endpoint
- REST API: **POST** `https://live.cpayapi.com/openapi/v1/pwpp`

## Parameters

| Name | Type | Mandatory | Description |
| :---- | :---- | :---- | :---- |
| merchantId | int64 | yes | unique id generated by CPay for merchant |
| merchantTradeNo | string(64) | yes | unique order id generated by merchant |
| userId | string(64) | yes | unique user id generated by merchant |
| storeCc | string(2) | no | whether the card will be stored in the bank:<br>0 = don't store it (default)<br>1 = store it <br> if `storeCc=1`, merchants will get parameter `ccStorageID` in response, and should store it  |
| ccStorageID | string(64) | no | the bank can complete a payment with this parameter instead of card information |
| firstName | string(20) | yes | first name on credit card   |
| lastName | string(30) | yes | last name on credit card   |
| email | string(64) | yes | email of billing, e.g. `hell@gamil.com` |
| iddCode | string(8) | yes | country calling code of billing, e.g. `852`(Hong Kong), see details [here](https://en.wikipedia.org/wiki/List_of_country_calling_codes) |
| mobile | string(64) | yes | mobile of billing, e.g. `712345678`, don't add the iddCode as a prefix |
| addressLine | string(64) | yes | address of billing |
| country | string(8) | yes | country of billing |
| city | string(64) | yes | city of billing |
| zip | string(16) | yes | postcode of address |
| cardNumber | string(64) | yes | credit card or debit card number |
| cvv | string(8) | yes | cvv code, e.g. `135` |
| expDate | string(16) | yes | expiration of the card, month/year, e.g. `12/27` means the card will be expired at Dec. 2027|
| ip | string(64) | yes | client IPV4 |
| document | string(64) | no | identification number of users |
| currency | string(8) | yes | currency code, e.g. `USD`, `EUR` and `BRL`. (all supported currencies](https://github.com/cpayapi-com/document/blob/main/country-region-currency.md#list-of-currency) |
| amount | string(32) | yes | amount to be paid, the precision is 2 decimal places, higher precision will be rounded, e.g. `19.011` -> `19.01`, `1.528` -> `1.53` |
| products | string(512) | no | product information, a JSON string, e.g. `[{"name":"iphone 11","price":"5300.00","num":"2","currency":"CNY"},{"name":"macBook","price":"1234.00","num":"1","currency":"USD"}]` |
| clientHTTPAccept | string(512) | no | field `Accept` of user's browser, it's mandatory if merchants use `payChannel2`, e.g. `text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7` |
| clientHTTPUserAgent | string(512) | no | field `UserAgent` of user's browser, it's mandatory if merchants use `payChannel2`, e.g. `Mozilla/5.0 (iPhone; CPU iPhone OS 11_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1` |
| callBackURL | string(256) | no | merchants will received notifications by this URL when payment `COMPLETED` or `CLOSED` |
| successURL | string(256) | no | redirect to this URL when payment `COMPLETED`  |
| failURL | string(256) | no | redirect to this URL when payment `CLOSED` |
| retURL | string(256) | no | if merchants use `payChannel2`, after finishing the 3DS processing, the bank will redirect users to this URL |
| payChannel | string(16) | no | all payment channels see [here](https://github.com/cpayapi-com/document/blob/main/country-region-currency.md#list-of-payment-channel) |
|txMode|string(16)| no        |The parameter of payChannel3, the enumeration value is: 1.redirect 2.h2h|
| createTime | string(20) | no | order created time (ms) in merchant side |
| sign | string(128) | yes | see [algorithm](https://github.com/cpayapi-com/document/blob/main/api-reference/signature.md) |


## Response

| Name | Type | Description |
| :---- | :---- | :---- |
| code | int64 | see [Error Code](https://github.com/cpayapi-com/document/blob/main/api-reference/error-code.md) |
| msg | string | description of `code` |
| traceid | string | unique request id generated by CPay |
| data.orderId | string | unique order id generated by CPay |
| data.orderStatus | int | see [Order Status](https://github.com/cpayapi-com/document/blob/main/api-reference/order-status.md) |
| data.pageData | string | original HTML,which returned from the bank,may be a page of 3DS/successful/failed. and it will be opened or rendered by merchants |
| data.redirectURL | string | the URL should be redirected to users by merchant if not empty |
| data.ccStorageID | string | unique credit card id generated by the bank if request parameter `storeCc=1` |

## Example

```shell
curl -X POST 'https://live.cpayapi.com/openapi/v1/pwpp' \
-H 'Content-Type: application/x-www-form-urlencoded' \
-d 'merchantId=206051&userId=M06051&amount=1&iddCode=34&mobile=34644789836&city=Sant%20Cugat&zip=08173&country=ES&cardNumber=5354632547818410&cvv=364&ip=123.123.121.62&currency=USD&firstName=erik&lastName=lara&email=erikaaronlara%40gmail.com&addressLine=ocea%20atlantic%2052&expDate=06%2F24&callBackURL=https%3A%2F%2Flive.cpayapi.com%2Fopenapi%2Fv1%2Fcallback%2Finvictus&successURL=https%3A%2F%2Fcashier.cpayapi.com%2Fsucced&failURL=https%3A%2F%2Fcashier.cpayapi.com%2Flose&merchantTradeNo=NO202305310016&products=[{%22name%22%3A%22pen%22%2C%22price%22%3A%220.5%22%2C%22num%22%3A%221%22%2C%22currency%22%3A%22USD%22}]&payChannel=payChannel1&createTime=1664353148000&clientHTTPAccept=text%2Fhtml%2Capplication%2Fxhtml%2Bxml%2Capplication%2Fxml%3Bq%3D0.9%2Cimage%2Favif%2Cimage%2Fwebp%2Cimage%2Fapng%2C*%2F*%3Bq%3D0.8%2Capplication%2Fsigned-exchange%3Bv%3Db3%3Bq%3D0.7&clientHTTPUserAgent=Mozilla%2F5.0%20(Macintosh%3B%20Intel%20Mac%20OS%20X%2010_15_7)%20AppleWebKit%2F537.36%20(KHTML%2C%20like%20Gecko)%20Chrome%2F112.0.0.0%20Safari%2F537.36&storeCc=1&sign=9c5c4b130b35349a7804ac4ab1a5081933c67ab700ff84176c6d323c9fe548ca'
```

- Successful Example 1
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "orderId": "2209141130105863014",
    "pageData": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n<meta charset=\"UTF-8\">\n<title>Link4Pay 3Dsecure</title>\n<style>\n body {\n margin: 0;\n }\n iframe.ifrale3ds {\n display: block;\n border: none;\n height: 100vh;\n width: 100vw;\n overflow:hidden;\n }\n    </style>\n</head>\n<body>\n<input type=\"hidden\" name=\"carddatajobID\" id=\"carddatajobID\" value=\"3c72fa0a-76ad-41c0-8aa7-c2d9843a6ec5\" />\n<iframe class=\"ifrale3ds\" title=\"Iframe 3DS\" name=\"challengeIframe\" id=\"challengeIframe\" sandbox=\"allow-same-origin allow-top-navigation allow-forms allow-scripts\"></iframe>\n<form id=\"challengeForm\" method=\"post\" target=\"challengeIframe\" action=\"https://bpcepaymentservices-3ds-vdm.wlp-acs.com/acs-challenge-browser-service/challenge/challengeRequest/browserBase/d3f1e50a-85ff-4982-8afe-d448",
    "redirectURL": "",
    "ccStorageID": "",
    "orderStatus": 11
  },
  "traceid": "221117082056X6478814"
}
```

- Successful Example 2
```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "orderId": "230612092831147905014",
        "orderStatus": 11,
        "redirectURL": "https://process.invictuspay.com/member/remoteCharge_Back.asp?TransID=100001&CompanyNum=202300000",
        "ccStorageID": "1696"
    },
    "traceid": "230612092831X1472663"
}
```

- Failed Example
```json
{
    "code": 90751019,
    "msg": "create order fail: pay fail",
    "data": null,
    "traceid": "230531100629X9029613"
}
```
